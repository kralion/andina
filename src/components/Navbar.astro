---
import { Button } from "@/components/ui/button";
import { X, Home, Users, Settings, Mail } from "lucide-react";
---
<nav
  role="navigation"
  data-navbar
  class="fixed inset-x-0 top-0 z-50 transition-all duration-300 ease-out">
  <div class="mx-auto max-w-7xl px-4">
    <div
      class="flex h-16 items-center justify-between gap-6 data-[scrolled=true]:h-16"
      data-inner
    >
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 relative z-20">
        <img src="/faviconAG.ico" alt="Andina logo" class="w-10 h-10" />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-8 md:flex text-white">
        <a href="/" class="relative group hover:text-primary transition-colors duration-300 flex items-center gap-2">
          <Home className="w-4 h-4 transition-transform duration-500 group-hover:rotate-[360deg]" />
          <span>Inicio</span>
          <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></div>
        </a>
        <a href="/nosotros" class="relative group hover:text-primary transition-colors duration-300 flex items-center gap-2">
          <Users className="w-4 h-4 transition-transform duration-500 group-hover:rotate-[360deg]" />
          <span>Nosotros</span>
          <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></div>
        </a>
        <a href="/servicios" class="relative group hover:text-primary transition-colors duration-300 flex items-center gap-2">
          <Settings className="w-4 h-4 transition-transform duration-500 group-hover:rotate-[360deg]" />
          <span>Servicios</span>
          <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></div>
        </a>
        <a href="/contacto" class="relative group hover:text-primary transition-colors duration-300 flex items-center gap-2">
          <Mail className="w-4 h-4 transition-transform duration-500 group-hover:rotate-[360deg]" />
          <span>Contacto</span>
          <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></div>
        </a>
      </div>

      <!-- Desktop CTA Button -->
      <div class="hidden md:block">
        <Button className="bg-primary hover:bg-white hover:text-primary cursor-pointer transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
          <Mail className="w-4 h-4" />
          <a href="/contacto">Solicitar Servicio</a>
        </Button>
      </div>

      <!-- Mobile Menu Button -->
      <button
        data-mobile-menu-toggle
        class="relative z-20 md:hidden p-2 text-white hover:text-primary transition-colors duration-300"
        aria-label="Abrir menÃº"
      >
        <div class="hamburger-icon w-6 h-6 flex flex-col justify-center items-center">
          <span class="hamburger-line block w-6 h-0.5 bg-current transform transition-all duration-300 ease-in-out origin-center"></span>
          <span class="hamburger-line block w-6 h-0.5 bg-current mt-1.5 transform transition-all duration-300 ease-in-out"></span>
          <span class="hamburger-line block w-6 h-0.5 bg-current mt-1.5 transform transition-all duration-300 ease-in-out origin-center"></span>
        </div>
        <X className="x-icon w-6 h-6 opacity-0 absolute top-1/2 left-1/2 " />
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    data-mobile-menu
    class="absolute top-16 left-0 right-0 z-50 hidden md:hidden bg-white border border-gray-200 shadow-lg mx-4 rounded-lg opacity-0 transform translate-y-2 transition-all duration-300 ease-out"
  >
    <div class="p-4 space-y-2">
      <a 
        href="/" 
        class="flex items-center gap-3 rounded-lg px-4 py-3 text-lg font-medium text-gray-900 hover:bg-gray-100"
        data-mobile-link
      >
        <Home className="w-5 h-5" />
        Inicio
      </a>
      <a 
        href="/nosotros" 
        class="flex items-center gap-3 rounded-lg px-4 py-3 text-lg font-medium text-gray-900 hover:bg-gray-100"
        data-mobile-link
      >
        <Users className="w-5 h-5" />
        Nosotros
      </a>
      <a 
        href="/servicios" 
        class="flex items-center gap-3 rounded-lg px-4 py-3 text-lg font-medium text-gray-900 hover:bg-gray-100"
        data-mobile-link
      >
        <Settings className="w-5 h-5" />
        Servicios
      </a>
      <a 
        href="/contacto" 
        class="flex items-center gap-3 rounded-lg px-4 py-3 text-lg font-medium text-gray-900 hover:bg-gray-100"
        data-mobile-link
      >
        <Mail className="w-5 h-5" /> 
        Contacto
      </a>
      <Button className="bg-primary hover:bg-white hover:text-primary cursor-pointer transition-all duration-300 transform hover:scale-105 w-full flex items-center gap-2">
        <Mail className="w-4 h-4" />
        <a href="/contacto">Solicitar Servicio</a>
      </Button>
  </div>
</nav>

<script is:inline>
  const nav = document.querySelector('nav[data-navbar]')
  const mobileMenuToggle = document.querySelector('[data-mobile-menu-toggle]')
  const mobileMenu = document.querySelector('[data-mobile-menu]')
  const mobileLinks = document.querySelectorAll('[data-mobile-link]')
  
  let isMenuOpen = false

  const setState = () => {
    const scrolled = window.scrollY > 10
    if (!nav) return
    nav.dataset.scrolled = String(scrolled)
    if (scrolled) {
      nav.classList.add('bg-neutral-800/90', 'backdrop-blur', 'shadow-sm')
    } else {
      nav.classList.remove('bg-neutral-800/90', 'backdrop-blur', 'shadow-sm')
    }
  }

  const openMenu = () => {
    if (!mobileMenu) return
    isMenuOpen = true
    
    mobileMenu.classList.remove('hidden')
    
    const hamburgerIcon = document.querySelector('.hamburger-icon')
    const xIcon = document.querySelector('.x-icon')
    
    hamburgerIcon.style.opacity = '0'
    hamburgerIcon.style.transform = 'scale(0.8)'
    
    setTimeout(() => {
      xIcon.style.opacity = '1'
      xIcon.style.transform = 'translate(-50%, -50%) scale(1)'
    }, 150)
    
    setTimeout(() => {
      mobileMenu.classList.remove('opacity-0', 'translate-y-2')
      mobileMenu.classList.add('opacity-100', 'translate-y-0')
    }, 10)
    
    mobileMenuToggle?.setAttribute('aria-expanded', 'true')
  }

  const closeMenu = () => {
    if (!mobileMenu) return
    isMenuOpen = false
    
    mobileMenu.classList.remove('opacity-100', 'translate-y-0')
    mobileMenu.classList.add('opacity-0', 'translate-y-2')
    
    const hamburgerIcon = document.querySelector('.hamburger-icon')
    const xIcon = document.querySelector('.x-icon')
    
    xIcon.style.opacity = '0'
    xIcon.style.transform = 'translate(-50%, -50%) scale(0.8)'
    
    setTimeout(() => {
      hamburgerIcon.style.opacity = '1'
      hamburgerIcon.style.transform = 'scale(1)'
    }, 150)
    
    setTimeout(() => {
      mobileMenu.classList.add('hidden')
    }, 300)
    
    mobileMenuToggle?.setAttribute('aria-expanded', 'false')
  }

  const toggleMobileMenu = () => {
    if (isMenuOpen) closeMenu()
    else openMenu()
  }

  const closeMobileMenu = () => {
    if (isMenuOpen) {
      toggleMobileMenu()
    }
  }

  setState()
  window.addEventListener('scroll', setState, { passive: true })
  
  if (mobileMenuToggle) {
    mobileMenuToggle.addEventListener('click', toggleMobileMenu)
  }
  
  mobileLinks.forEach(link => {
    link.addEventListener('click', closeMenu)
  })

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) closeMenu()
  })

  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768 && isMenuOpen) closeMenu()
  })
</script>
